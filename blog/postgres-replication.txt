2:"$Sreact.suspense"
4:I[9275,[],""]
6:I[1343,[],""]
7:I[7929,["231","static/chunks/231-729c2000e7bf0f03.js","185","static/chunks/app/layout-c3ecaed4563f2639.js"],"default"]
8:I[231,["231","static/chunks/231-729c2000e7bf0f03.js","173","static/chunks/173-8fa9e7bcfdf3a3cf.js","308","static/chunks/app/blog/%5Bslug%5D/page-68fa4c94b2d91b55.js"],""]
5:["slug","postgres-replication","d"]
0:["9y3eikjO_yOdiz5KPPyRo",[[["",{"children":["blog",{"children":[["slug","postgres-replication","d"],{"children":["__PAGE__?{\"slug\":\"postgres-replication\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["slug","postgres-replication","d"],{"children":["__PAGE__",{},[["$L1",["$","section",null,{"children":[["$","div",null,{"className":"flex justify-between items-center mt-2 mb-8 text-sm max-w-[650px]","children":["$","$2",null,{"fallback":["$","p",null,{"className":"h-5"}],"children":["$","p",null,{"className":"text-sm text-neutral-600 dark:text-neutral-400"}]}]}],["$","article",null,{"className":"prose prose-quoteless prose-neutral dark:prose-invert","children":"$L3"}]]}]],null],null]},["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$5","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}],null]},["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}],null]},[["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__variable_dbdb1e bg-stone-900 text-violet-50 lg:text-base text-sm font-sans max-w-screen-md lg:p-4 p-1 w-full flex flex-col gap-10 m-auto text-justify","children":[["$","header",null,{"className":"flex justify-between items-center py-10","children":[["$","div",null,{"id":"menu","className":"flex-grow flex flex-col justify-start","children":["$","$L7",null,{}]}],["$","$L8",null,{"href":"https://github.com/ppvan","className":"rounded-full w-10 lg:w-12 overflow-hidden","children":["$","img",null,{"alt":"ppvan's github avatar","src":"https://avatars.githubusercontent.com/ppvan"}]}]]}],["$","$L4",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":null}],["$","footer",null,{"className":"h-20"}]]}]}],null],null],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/2cee820629769833.css","precedence":"next","crossOrigin":"$undefined"}]],"$L9"]]]]
a:I[8173,["231","static/chunks/231-729c2000e7bf0f03.js","173","static/chunks/173-8fa9e7bcfdf3a3cf.js","308","static/chunks/app/blog/%5Bslug%5D/page-68fa4c94b2d91b55.js"],"Image"]
b:Te7b,<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">sudo</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">mkdir</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">-</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">p</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--keyword" style="color: var(--sh-keyword)">var</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">lib</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">archive</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">sudo</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">chmod</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">700</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--keyword" style="color: var(--sh-keyword)">var</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">lib</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">archive</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">sudo</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">chown</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgres</span><span class="sh__token--sign" style="color: var(--sh-sign)">:</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgres</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--keyword" style="color: var(--sh-keyword)">var</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">lib</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">archive</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>c:T1e47,<span class="sh__line"><span class="sh__token--sign" style="color: var(--sh-sign)">#</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--keyword" style="color: var(--sh-keyword)">var</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">lib</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">data</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">.</span><span class="sh__token--property" style="color: var(--sh-property)">conf</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">listen_addresses</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--string" style="color: var(--sh-string)">*</span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">#</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">need</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--keyword" style="color: var(--sh-keyword)">in</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">docker</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">container</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">wal_level</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">hot_standby</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">synchronous_commit</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">on</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">#</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">syncchoronous</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">standby</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">archive_mode</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">on</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">#</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">also</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">archive</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">WALs</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">archive_command</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--string" style="color: var(--sh-string)">cp %p /var/lib/postgresql/archive/%f</span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">max_wal_senders</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">2</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">wal_keep_segments</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">10</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">synchronous_standby_names</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--string" style="color: var(--sh-string)">slave_db</span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">#</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">slave</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">name</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>d:T961,<span class="sh__line"><span class="sh__token--class" style="color: var(--sh-class)">CREATE</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">ROLE</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">replica</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">LOGIN</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">REPLICATION</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">PASSWORD</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--string" style="color: var(--sh-string)">replica</span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--sign" style="color: var(--sh-sign)">;</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--class" style="color: var(--sh-class)">ALTER</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">ROLE</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">replica</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">WITH</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">CONNECTION</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">LIMIT</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">8</span><span class="sh__token--sign" style="color: var(--sh-sign)">;</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>e:Ta6a,<span class="sh__line"><span class="sh__token--sign" style="color: var(--sh-sign)">#</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--string" style="color: var(--sh-string)">/var/lib</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">data</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">pg_hba</span><span class="sh__token--sign" style="color: var(--sh-sign)">.</span><span class="sh__token--property" style="color: var(--sh-property)">conf</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">host</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--space" style="color: var(--sh-space)">   </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">replication</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--space" style="color: var(--sh-space)">    </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">replica</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--space" style="color: var(--sh-space)">        </span><span class="sh__token--class" style="color: var(--sh-class)">0</span><span class="sh__token--sign" style="color: var(--sh-sign)">.</span><span class="sh__token--class" style="color: var(--sh-class)">0</span><span class="sh__token--sign" style="color: var(--sh-sign)">.</span><span class="sh__token--class" style="color: var(--sh-class)">0</span><span class="sh__token--sign" style="color: var(--sh-sign)">.</span><span class="sh__token--class" style="color: var(--sh-class)">0</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--class" style="color: var(--sh-class)">0</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--space" style="color: var(--sh-space)">        </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">md5</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>f:T85f,<span class="sh__line"><span class="sh__token--sign" style="color: var(--sh-sign)">#</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--keyword" style="color: var(--sh-keyword)">export</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--class" style="color: var(--sh-class)">PGDATA</span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--string" style="color: var(--sh-string)">/var/lib</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">data</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">rm</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">-</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">rf</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--string" style="color: var(--sh-string)">&quot;</span><span class="sh__token--string" style="color: var(--sh-string)">${PGDATA}</span><span class="sh__token--string" style="color: var(--sh-string)">&quot;</span><span class="sh__token--comment" style="color: var(--sh-comment)">/*</span></span>
<span class="sh__line"><span class="sh__token--comment" style="color: var(--sh-comment)"></span></span>
<span class="sh__line"><span class="sh__token--comment" style="color: var(--sh-comment)">pg_basebackup -d &quot;user=replica password=replica host=db&quot; -D &quot;${PGDATA}&quot; -Fp -Xs -P -R</span></span>
<span class="sh__line"><span class="sh__token--comment" style="color: var(--sh-comment)"></span></span>10:Tbdf,<span class="sh__line"><span class="sh__token--sign" style="color: var(--sh-sign)">#</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--keyword" style="color: var(--sh-keyword)">var</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">lib</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">data</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">.</span><span class="sh__token--property" style="color: var(--sh-property)">conf</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">listen_addresses</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--string" style="color: var(--sh-string)">*</span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">#</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">need</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--keyword" style="color: var(--sh-keyword)">in</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">docker</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">container</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">wal_level</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--identifier" style="color: var(--sh-identifier)">hot_standby</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>11:T7cf,<span class="sh__line"><span class="sh__token--sign" style="color: var(--sh-sign)">#</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--keyword" style="color: var(--sh-keyword)">var</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">lib</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">data</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">.</span><span class="sh__token--property" style="color: var(--sh-property)">auto</span><span class="sh__token--sign" style="color: var(--sh-sign)">.</span><span class="sh__token--property" style="color: var(--sh-property)">conf</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>
<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">primary_conninfo</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--sign" style="color: var(--sh-sign)">=</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--string" style="color: var(--sh-string)">user=replica password=replica host=db port=5432 sslmode=prefer sslcompression=0 gssencmode=disable target_session_attrs=any application_name=slave_db</span><span class="sh__token--string" style="color: var(--sh-string)">&#039;</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>12:T442,<span class="sh__line"><span class="sh__token--identifier" style="color: var(--sh-identifier)">touch</span><span class="sh__token--space" style="color: var(--sh-space)"> </span><span class="sh__token--keyword" style="color: var(--sh-keyword)">var</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">lib</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">postgresql</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">data</span><span class="sh__token--sign" style="color: var(--sh-sign)">/</span><span class="sh__token--identifier" style="color: var(--sh-identifier)">standby</span><span class="sh__token--sign" style="color: var(--sh-sign)">.</span><span class="sh__token--property" style="color: var(--sh-property)">signal</span><span class="sh__token--break" style="color: var(--sh-break)"></span></span>3:[["$","h1",null,{"className":"text-slate-200 font-bold font-source text-3xl my-4","children":"Replication guide with postgres and docker compose."}],"\n",["$","blockquote",null,{"className":"bg-transparent opacity-80 border-l-4 border-[#34495e] pl-4 my-4","children":["\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":["This guide provide some understanding about replication and implemented by ",["$","code",null,{"dangerouslySetInnerHTML":{"__html":"<span class=\"sh__line\"><span class=\"sh__token--identifier\" style=\"color: var(--sh-identifier)\">docker</span><span class=\"sh__token--sign\" style=\"color: var(--sh-sign)\">-</span><span class=\"sh__token--identifier\" style=\"color: var(--sh-identifier)\">compose</span></span>"},"className":"font-source rounded-lg px-2 py-1 highlight"}],".\nRealworld replication is strongly tied to deployment."]}],"\n"]}],"\n",["$","h2",null,{"className":"text-slate-300 font-semibold font-source text-2xl my-3","children":"Concepts"}],"\n",["$","h3",null,{"className":"text-slate-300 font-source text-xl my-2","children":"Replication"}],"\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":"Replication is a solution(among many others) to allow a second server to take over quickly if primary server fails(high availibility) or allow serveral server serve same data (load balancer). This document only focus on replication."}],"\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":"In replication, there are 3 types of server:"}],"\n",["$","ul",null,{"className":"list-disc pl-8","children":["\n",["$","li",null,{"className":"text-slate-400 font-source text-lg","children":"Primary server: read/write queries"}],"\n",["$","li",null,{"className":"text-slate-400 font-source text-lg","children":"Warn standby server: do nothing until promoted to primary, often use for high availibility"}],"\n",["$","li",null,{"className":"text-slate-400 font-source text-lg","children":"Hot standby server: read queries, user for load balancing"}],"\n"]}],"\n",["$","h3",null,{"className":"text-slate-300 font-source text-xl my-2","children":"Write ahead logs(WAL)"}],"\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":"Write ahead logs is a pattern to ensure ACID property of database. Basiclly you write logs before make any changes to database. So you can archive that logs and recorver them on another server."}],"\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":"Replication can be achieved by continously archive WAL on primary and applying them on replication."}],"\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":["$","$L8",null,{"href":"https://mermaid.live/edit#pako:eNqNkE1Pg0AQhv_KZk41AQKLfO3BxMRjvdiDieBhClMhBZYsH4qE_-6W2qZGY7qH-dj3mcm7O0EqMwIBu1K-pzmqjq2fkprpU2HbkYpXj0tmGXa4xZZuXo8yqjQvBsriU8FaUgOpb7ktcSAnXm0O-dfwovJ_Vfcv9dIZM022xXTfN-z5fq27u7OnE3i2plFFqdT2xgU8ursG4tdALhhQkaqwyPRXToeRBLqcKkpA6DJDtU8gqWfNYd_JzVinIDrVkwF9ox9IDwW-KaxA7LBs9W2D9YuUP3oQE3yA4IFn8dD3uWNHbuAZMIIwncjSrWfbYahDFPj-bMDnssC2Is_jrst1cOxb7s9fc1ad_A","className":"text-[#9e98f2] underline","children":["$","$La",null,{"src":"https://mermaid.ink/img/pako:eNqNkE1Pg0AQhv_KZk41AQKLfO3BxMRjvdiDieBhClMhBZYsH4qE_-6W2qZGY7qH-dj3mcm7O0EqMwIBu1K-pzmqjq2fkprpU2HbkYpXj0tmGXa4xZZuXo8yqjQvBsriU8FaUgOpb7ktcSAnXm0O-dfwovJ_Vfcv9dIZM022xXTfN-z5fq27u7OnE3i2plFFqdT2xgU8ursG4tdALhhQkaqwyPRXToeRBLqcKkpA6DJDtU8gqWfNYd_JzVinIDrVkwF9ox9IDwW-KaxA7LBs9W2D9YuUP3oQE3yA4IFn8dD3uWNHbuAZMIIwncjSrWfbYahDFPj-bMDnssC2Is_jrst1cOxb7s9fc1ad_A?type=png","alt":"","className":"rounded-lg my-4 block m-auto","children":"$undefined"}]}]}],"\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":"Note that the process is async by default, so slaves may not be up-to-date with master. This can be solved by streaming WAL over TCP and setup a synchronous slave. Even so, there is a window for data loss should the primary server suffer a catastrophic failure; transactions not yet shipped will be lost"}],"\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":["$","$L8",null,{"href":"https://mermaid.live/edit#pako:eNp9kE1LxDAQhv9KGFhYoS1tar9yEASP68U9CLYexnbWFvuxJGl1Lf3vpnVlEaUJzDuT551kyAh5VxAIONTde16i1Gz3kLXMrAaVJplu7xdlBWp8QUVXz994s2Eo87IaqEh_EqZIDiTPDlXjQF663c_6p3-hfJX6_9F5X8Zjts0eb3fK6M35wXXM17EPFjQkG6wK8ynjbM5Al9RQBsKkBcq3DLJ2Mj7sdbc_tTkILXuyoD-aOemuwleJDYgD1sqcHrF96rpfNYgRPkDwKHB4HIbccxM_Ciw4gbC9xDFl4LpxbEISheFkwedygeskQcB9n5vgudc8nL4AHKiJ6A","className":"text-[#9e98f2] underline","children":["$","$La",null,{"src":"https://mermaid.ink/img/pako:eNp9kE1LxDAQhv9KGFhYoS1tar9yEASP68U9CLYexnbWFvuxJGl1Lf3vpnVlEaUJzDuT551kyAh5VxAIONTde16i1Gz3kLXMrAaVJplu7xdlBWp8QUVXz994s2Eo87IaqEh_EqZIDiTPDlXjQF663c_6p3-hfJX6_9F5X8Zjts0eb3fK6M35wXXM17EPFjQkG6wK8ynjbM5Al9RQBsKkBcq3DLJ2Mj7sdbc_tTkILXuyoD-aOemuwleJDYgD1sqcHrF96rpfNYgRPkDwKHB4HIbccxM_Ciw4gbC9xDFl4LpxbEISheFkwedygeskQcB9n5vgudc8nL4AHKiJ6A?type=png","alt":"","className":"rounded-lg my-4 block m-auto","children":"$undefined"}]}]}],"\n",["$","h3",null,{"className":"text-slate-300 font-source text-xl my-2","children":"Slave life-cycle"}],"\n",["$","h3",null,{"className":"text-slate-300 font-source text-xl my-2","children":"Failover problems"}],"\n",["$","h2",null,{"className":"text-slate-300 font-semibold font-source text-2xl my-3","children":"Setup and config"}],"\n",["$","blockquote",null,{"className":"bg-transparent opacity-80 border-l-4 border-[#34495e] pl-4 my-4","children":["\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":["Heavily specialize in docker evironment. You can get full setup using docker compose ",["$","$L8",null,{"href":"https://github.com/ppvan/master-slave-todos","className":"text-[#9e98f2] underline","children":"here"}]]}],"\n"]}],"\n",["$","h3",null,{"className":"text-slate-300 font-source text-xl my-2","children":"Config master node"}],"\n",["$","h4",null,{"className":"text-slate-300 font-source text-lg my-1","children":"Create archive directory"}],"\n",["$","pre",null,{"className":"bg-[#21262d] rounded p-1 overflow-x-auto","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$b"},"className":"language-sh"}]}],"\n",["$","h4",null,{"className":"text-slate-300 font-source text-lg my-1","children":"Config postgres.conf"}],"\n",["$","pre",null,{"className":"bg-[#21262d] rounded p-1 overflow-x-auto","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$c"},"className":"language-conf"}]}],"\n",["$","h4",null,{"className":"text-slate-300 font-source text-lg my-1","children":"Create replication user with replication priviledge"}],"\n",["$","pre",null,{"className":"bg-[#21262d] rounded p-1 overflow-x-auto","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$d"},"className":"language-sql"}]}],"\n",["$","h3",null,{"className":"text-slate-300 font-source text-xl my-2","children":"Allow remote replica connect"}],"\n",["$","blockquote",null,{"className":"bg-transparent opacity-80 border-l-4 border-[#34495e] pl-4 my-4","children":["\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":"Add following to the end of pg_hba.conf"}],"\n"]}],"\n",["$","pre",null,{"className":"bg-[#21262d] rounded p-1 overflow-x-auto","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$e"},"className":"language-conf"}]}],"\n",["$","h3",null,{"className":"text-slate-300 font-source text-xl my-2","children":"Config slave node"}],"\n",["$","h4",null,{"className":"text-slate-300 font-source text-lg my-1","children":"Replication master data"}],"\n",["$","pre",null,{"className":"bg-[#21262d] rounded p-1 overflow-x-auto","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$f"},"className":"language-sh"}]}],"\n",["$","h4",null,{"className":"text-slate-300 font-source text-lg my-1","children":"Create config and standby.signal"}],"\n",["$","blockquote",null,{"className":"bg-transparent opacity-80 border-l-4 border-[#34495e] pl-4 my-4","children":["\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":"standby.signal is needed so postgres change to standby mode (slave mode)"}],"\n"]}],"\n",["$","pre",null,{"className":"bg-[#21262d] rounded p-1 overflow-x-auto","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$10"},"className":"language-conf"}]}],"\n",["$","pre",null,{"className":"bg-[#21262d] rounded p-1 overflow-x-auto","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$11"},"className":"language-conf"}]}],"\n",["$","pre",null,{"className":"bg-[#21262d] rounded p-1 overflow-x-auto","children":["$","code",null,{"dangerouslySetInnerHTML":{"__html":"$12"},"className":"language-sh"}]}],"\n",["$","h2",null,{"className":"text-slate-300 font-semibold font-source text-2xl my-3","children":"Reference"}],"\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":["$","$L8",null,{"href":"https://www.postgresql.org/docs/current/high-availability.html","className":"text-[#9e98f2] underline","children":"Postgresql documentation, chapter 27"}]}],"\n",["$","p",null,{"className":"text-slate-400 font-source text-lg","children":["$","$L8",null,{"href":"https://www.postgresql.vn/blog/setup_master_slave_for_postgres12","className":"text-[#9e98f2] underline","children":"Postgres VN, setup master slave"}]}]]
9:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"ppvan's Hub"}],["$","meta","3",{"name":"description","content":"My personal space on the internet"}],["$","meta","4",{"name":"author","content":"Phạm Văn Phúc"}],["$","link","5",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"128x128"}],["$","meta","6",{"name":"next-size-adjust"}]]
1:null
